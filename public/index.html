<!DOCTYPE html>
<html>
<head>
  <title>Blog</title>
  <meta charset='utf-8'>
  <style>
    #ta {
      margin: 20px;
    }
    .div {
      border: 1px solid black;
      border-radius: 3px;
      margin: 20px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <textarea id='ta'>

  </textarea>
  <button id='submit'>
    Submit
  </button>
</body>
<script>
  'use strict'

  const parseResponse = res => {
    return res.json()
  }

  const api = {
    getArticle: id => fetch(`http://localhost:8080/article/${id}`, {mode: 'cors'}).then(parseResponse),
    setArticle: (id, content) => fetch(`http://localhost:8080/article/`, {
      method: 'post',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, content }),
    }).then(parseResponse),
  }

  const addArticle = content => {
    const div = document.createElement('div')
    document.body.appendChild(div)
    div.className = 'div'
    div.textContent = content
  }

  api.getArticle('')
    .then(arr => Promise.all(arr.map(api.getArticle)))
    .then(arr => arr.map(addArticle))

  const submit = document.getElementById('submit')

  submit.onclick = async () => {
    const ta = document.getElementById('ta')
    if (!ta.value.trim()) return
    await api.setArticle('', ta.value)
    addArticle(ta.value)
    ta.value = ''
  }

</script>
</html>